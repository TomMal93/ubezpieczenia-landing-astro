---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Section from '@/components/ui/Section.astro';
import Container from '@/components/ui/Container.astro';
import Button from '@/components/ui/Button.astro';
import Eyebrow from '@/components/ui/Eyebrow.astro';
import Card from '@/components/ui/Card.astro';
import Input from '@/components/ui/Input.astro';
import Textarea from '@/components/ui/Textarea.astro';
import { Image } from 'astro:assets';
import hero from '@/assets/hero.jpg';
import ReviewSlider from '@/components/islands/ReviewSlider.svelte';
import FaqAccordion from '@/components/islands/FaqAccordion.svelte';
import MobileCta from '@/components/ui/MobileCta.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

const pageTitle = 'Ubezpieczenia szyte na miarę – szybko, prosto, bez ukrytych haczyków.';
const pageDesc =
  'Porównujemy oferty 12 towarzystw i pomagamy wybrać najlepszą ochronę dla Ciebie i Twojej firmy.';

const faqItems = (await getCollection('faq'))
  .sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0))
  .map((i) => ({ q: i.data.question, a: i.data.answer }));

const plans = (await getCollection('pricing')) as CollectionEntry<'pricing'>[];
const cta = (await getCollection('cta'))[0];
---

<BaseLayout title={pageTitle} description={pageDesc} ogImage="/images/hero.jpg">
  <!-- HERO -->
  <Section class="pt-6 sm:pt-10">
    <Container>
      <div class="grid lg:grid-cols-2 items-center gap-8 sm:gap-10">
        <div>
          <Eyebrow>Bezpiecznie i transparentnie</Eyebrow>
          <h1 class="mt-2 font-extrabold">{pageTitle}</h1>
          <p class="lead mt-3">{pageDesc}</p>
          <div class="mt-5 flex gap-3">
            <Button href="#kontakt" ariaLabel="Uzyskaj wycenę">Uzyskaj wycenę</Button>
            <Button href="tel:123456789" variant="ghost" ariaLabel="Zadzwoń"
              >Zadzwoń: 123 456 789</Button
            >
          </div>

          <div class="mt-6 grid grid-cols-1 sm:grid-cols-3 gap-3">
            <Card
              ><p class="text-sm">
                <strong>4.9/5</strong><br /><span class="muted">opinie klientów</span>
              </p></Card
            >
            <Card
              ><p class="text-sm">
                <strong>24/7</strong><br /><span class="muted">Assistance</span>
              </p></Card
            >
            <Card
              ><p class="text-sm">
                <strong>12</strong><br /><span class="muted">towarzystw w porównaniu</span>
              </p></Card
            >
          </div>
        </div>

        <div class="relative order-first lg:order-none">
          <Image
            src={hero}
            alt="Rodzina korzystająca z ubezpieczenia – spokój i bezpieczeństwo"
            widths={[400, 600, 800, 1200]}
            sizes="(max-width: 1024px) 100vw, 600px"
            class="rounded-2xl shadow-lg w-full h-auto"
            loading="eager"
            decoding="async"
          />
        </div>
      </div>
    </Container>
  </Section>

  <!-- OFERTA skrót -->
  <Section id="oferta" class="bg-[var(--surface-1)]">
    <Container>
      <Eyebrow>Oferta w skrócie</Eyebrow>
      <h2 class="text-3xl font-bold mt-2">Kompleksowa ochrona dla Ciebie i firmy</h2>
      <div class="mt-6 grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <Card
          ><h3 class="font-semibold">OC / AC</h3><p class="muted mt-1">
            Dla kierowców – najlepszy pakiet w rozsądnej cenie.
          </p></Card
        >
        <Card
          ><h3 class="font-semibold">Mieszkanie</h3><p class="muted mt-1">
            Mienie, assistance, OC w życiu prywatnym.
          </p></Card
        >
        <Card
          ><h3 class="font-semibold">Życie</h3><p class="muted mt-1">
            Indywidualnie dobrana suma ubezpieczenia.
          </p></Card
        >
        <Card
          ><h3 class="font-semibold">Firmowe</h3><p class="muted mt-1">
            Ochrona majątku i odpowiedzialności.
          </p></Card
        >
      </div>
    </Container>
  </Section>

  <!-- PROCES -->
  <Section>
    <Container>
      <Eyebrow>Jak to działa</Eyebrow>
      <h2 class="text-3xl font-bold mt-2">3 kroki do odpowiedniej polisy</h2>
      <div class="mt-6 grid gap-4 md:grid-cols-3">
        <Card
          ><h3 class="font-semibold mb-1">1. Krótka rozmowa</h3><p class="muted">
            Poznajemy Twoje potrzeby: zakres, budżet, preferencje.
          </p></Card
        >
        <Card
          ><h3 class="font-semibold mb-1">2. Porównanie ofert</h3><p class="muted">
            Analizujemy 12 towarzystw i rekomendujemy najlepsze opcje.
          </p></Card
        >
        <Card
          ><h3 class="font-semibold mb-1">3. Szybkie formalności</h3><p class="muted">
            Podpis online i… gotowe. Otrzymujesz polisę na maila.
          </p></Card
        >
      </div>
    </Container>
  </Section>

  <!-- OPINIE (Svelte island) -->
  <Section class="bg-[var(--surface-1)]">
    <Container>
      <Eyebrow>Opinie klientów</Eyebrow>
      <h2 class="text-3xl font-bold mt-2">Zaufanie budujemy działaniem</h2>
      <div class="mt-6 max-w-2xl">
        <ReviewSlider
          client:load
          reviews={[
            {
              author: 'Karolina, Wrocław',
              text: 'Szybko i bez stresu. Najlepsza cena OC na rynku.',
            },
            { author: 'Marek, Poznań', text: 'Świetne wyjaśnienie różnic między wariantami AC.' },
            { author: 'Anna, Gdańsk', text: 'Całość ogarnięta zdalnie w jeden dzień. Polecam!' },
          ]}
        />
      </div>
    </Container>
  </Section>

  <!-- FAQ (Content Collections + Svelte island) -->
  <Section id="o-nas">
    <Container>
      <Eyebrow>FAQ</Eyebrow>
      <h2 class="text-3xl font-bold mt-2">Najczęstsze pytania</h2>
      <div class="mt-6">
        <FaqAccordion client:load items={faqItems} />
      </div>
    </Container>
  </Section>

  <!-- CENNIK (Content Collections) -->
  <Section class="bg-[var(--surface-1)]">
    <Container>
      <Eyebrow>Cennik</Eyebrow>
      <h2 class="text-3xl font-bold mt-2">Przejrzyste pakiety</h2>
      <div class="mt-6 grid gap-4 md:grid-cols-3">
        {
          plans.map((p) => (
            <Card>
              <h3 class="font-semibold">{p.data.name}</h3>
              <p class="text-2xl mt-1">{p.data.price}</p>
              <ul class="mt-3 space-y-1">
                {p.data.features.map((f: string) => (
                  <li>• {f}</li>
                ))}
              </ul>
              <a href="#kontakt" class="btn mt-4 inline-flex">
                Wybierz
              </a>
            </Card>
          ))
        }
      </div>
    </Container>
  </Section>

  <!-- CTA (Content Collections) -->
  <Section>
    <Container>
      <div class="card p-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h2 class="text-2xl font-bold">{cta?.data.title ?? 'Gotowy na wycenę?'}</h2>
          <p class="muted">
            {cta?.data.description ?? 'Zajmie to mniej niż 2 minuty. Oddzwonimy dziś.'}
          </p>
        </div>
        <a href="#kontakt" class="btn">Uzyskaj wycenę</a>
      </div>
    </Container>
  </Section>

  <!-- KONTAKT -->
  <Section id="kontakt" class="bg-[var(--surface-1)]">
    <Container>
      <Eyebrow>Kontakt</Eyebrow>
      <h2 class="text-3xl font-bold mt-2">Porozmawiaj z doradcą</h2>
      <form
        id="contact-form"
        class="mt-6 grid gap-4 md:grid-cols-2 card p-4 sm:p-6"
        action="#"
        method="post"
        novalidate
      >
        <div><Input id="name" label="Imię i nazwisko" required placeholder="Jan Kowalski" /></div>
        <div>
          <Input id="email" type="email" label="E-mail" required placeholder="jan@przyklad.pl" />
        </div>
        <div><Input id="phone" type="tel" label="Telefon" placeholder="+48 123 456 789" /></div>
        <div class="md:col-span-2">
          <Textarea
            id="message"
            label="Wiadomość"
            rows={6}
            placeholder="Opisz, czego potrzebujesz"
          />
        </div>
        <div class="md:col-span-2 flex items-start gap-2">
          <input id="agree" type="checkbox" required class="mt-1" />
          <label for="agree" class="text-sm muted"
            >Wyrażam zgodę na kontakt telefoniczny lub e-mail w celu przygotowania oferty.</label
          >
        </div>
        <div><button class="btn tap-target" aria-label="Wyślij">Wyślij</button></div>
        <p id="form-msg" class="md:col-span-2 text-sm muted" aria-live="polite"></p>
      </form>
      <script type="module">
        const form = document.getElementById('contact-form');
        const msg = document.getElementById('form-msg');
        form?.addEventListener('submit', (e) => {
          e.preventDefault();
          const f = e.currentTarget;
          if (!f.checkValidity()) {
            f.reportValidity();
            msg.textContent = 'Uzupełnij wymagane pola.';
            return;
          }
          msg.textContent = 'Dziękujemy! Skontaktujemy się wkrótce.';
          f.reset();
        });
      </script>
    </Container>
  </Section>

  <!-- Sticky CTA na mobile -->
  <MobileCta />
</BaseLayout>
