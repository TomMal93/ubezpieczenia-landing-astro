---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/ui/Container.astro';
import Section from '@/components/ui/Section.astro';
import PostHeader from '@/components/blog/PostHeader.astro';
import Prose from '@/components/blog/Prose.astro';
import { getPosts, getPostBySlug } from '@/lib/hygraph';
import { formatDatePL } from '@/lib/utils';

export async function getStaticPaths() {
  const posts = await getPosts(100, 0);
  return posts.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const post = await getPostBySlug(slug!);

if (!post) {
  throw new Error('Post not found');
}

const title = post.title;
const description = post.excerpt ?? '';
const ogImage = post.coverImage?.url ?? '/images/hero.jpg';
---

<BaseLayout title={title} description={description} ogImage={ogImage}>
  <Section>
    <Container>
      <PostHeader title={title} date={formatDatePL(post.publishedAt)} tags={post.tags ?? []} />
      <Prose>
        <article class="prose">
          <div set:html={post.content?.html ?? ''} />
        </article>
      </Prose>
      <div class="mt-10">
        <a class="btn-ghost" href="/blog">← Wróć do bloga</a>
      </div>
    </Container>
  </Section>
</BaseLayout>
