---
import 'uno.css';
import '@/styles/global.css';

const {
  title = 'Ubezpieczenia – szybko, prosto, bez haczyków',
  description = 'Porównujemy oferty 12 towarzystw i pomagamy wybrać najlepszą ochronę.',
  ogImage = '/images/hero.jpg',
} = Astro.props as {
  title?: string;
  description?: string;
  ogImage?: string;
};
---

<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={description} />
    <title>{title}</title>

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta
      property="og:image"
      content={new URL(ogImage, Astro.site ?? 'https://przyklad-ubezpieczenia.pl').toString()}
    />
    <meta property="og:type" content="website" />
    <link rel="icon" href="/images/favicon.svg" type="image/svg+xml" />
    <link rel="icon" href="/images/favicon.ico" sizes="any" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />

    <style is:global>
      .site-header[data-scrolled='true'] {
        box-shadow: var(--shadow-2);
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(6px);
      }
      .mobile-nav[hidden] {
        display: none;
      }
    </style>

    {
      import.meta.env.CF_WEB_ANALYTICS_TOKEN && (
        <script
          defer
          src="https://static.cloudflareinsights.com/beacon.min.js"
          data-cf-beacon={`{"token": "${import.meta.env.CF_WEB_ANALYTICS_TOKEN}"}`}
        />
      )
    }
  </head>
  <body>
    <header
      class="site-header sticky top-0 z-50 border-b border-[var(--surface-2)] bg-white/80 backdrop-blur"
    >
      <nav class="container flex items-center justify-between py-3" aria-label="Główna nawigacja">
        <a href="/" class="flex items-center gap-2 ring-focus" aria-label="Strona główna">
          <img
            src="/images/logo.svg"
            alt="TwojeUbezpieczenia – logo"
            width="28"
            height="28"
            decoding="async"
            fetchpriority="high"
          />
          <span class="font-semibold">TwojeUbezpieczenia</span>
        </a>

        <!-- Desktop -->
        <ul class="hidden md:flex items-center gap-6">
          <li><a class="btn-ghost tap-target" href="/#oferta">Oferta</a></li>
          <li><a class="btn-ghost tap-target" href="/#o-nas">O nas</a></li>
          <li><a class="btn-ghost tap-target" href="/blog">Blog</a></li>
          <li>
            <a class="btn tap-target" href="/#kontakt" aria-label="Uzyskaj wycenę">Uzyskaj wycenę</a
            >
          </li>
        </ul>

        <!-- Mobile toggle -->
        <button
          id="menu-toggle"
          class="icon-btn md:hidden"
          aria-label="Otwórz menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
            ><path
              d="M4 7h16M4 12h16M4 17h16"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"></path></svg
          >
        </button>
      </nav>

      <!-- Off-canvas mobile menu -->
      <div id="mobile-overlay" class="overlay md:hidden mobile-nav" hidden></div>
      <nav id="mobile-menu" class="drawer md:hidden mobile-nav" aria-label="Menu mobilne" hidden>
        <div class="flex items-center justify-between mb-4">
          <strong>Menu</strong>
          <button id="menu-close" class="icon-btn" aria-label="Zamknij menu">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
              ><path
                d="M6 6l12 12M18 6L6 18"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"></path></svg
            >
          </button>
        </div>
        <ul class="space-y-1">
          <li><a class="btn-ghost tap-target w-full" href="/#oferta">Oferta</a></li>
          <li><a class="btn-ghost tap-target w-full" href="/#o-nas">O nas</a></li>
          <li><a class="btn-ghost tap-target w-full" href="/blog">Blog</a></li>
          <li>
            <a class="btn tap-target w-full justify-center" href="/#kontakt">Uzyskaj wycenę</a>
          </li>
        </ul>
      </nav>

      <script is:inline>
        const header = document.querySelector('.site-header');
        const onScroll = () =>
          header && header.setAttribute('data-scrolled', String(window.scrollY > 4));
        onScroll();
        window.addEventListener('scroll', onScroll, { passive: true });

        const toggleBtn = document.getElementById('menu-toggle');
        const closeBtn = document.getElementById('menu-close');
        const menu = document.getElementById('mobile-menu');
        const overlay = document.getElementById('mobile-overlay');

        const open = (v) => {
          menu.hidden = overlay.hidden = !v;
          toggleBtn?.setAttribute('aria-expanded', String(v));
          document.body.style.overflow = v ? 'hidden' : '';
        };
        toggleBtn?.addEventListener('click', () => open(menu.hidden));
        closeBtn?.addEventListener('click', () => open(false));
        overlay?.addEventListener('click', () => open(false));
        window.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') open(false);
        });
      </script>
    </header>

    <main><slot /></main>

    <footer class="mt-16 border-t border-[var(--surface-2)]">
      <div class="container py-10 grid gap-8 md:grid-cols-3">
        <div>
          <div class="flex items-center gap-2 mb-2">
            <img src="/images/logo.svg" alt="" width="24" height="24" />
            <strong>TwojeUbezpieczenia</strong>
          </div>
          <p class="muted">Bezpiecznie. Transparentnie. Po ludzku.</p>
        </div>
        <div>
          <div class="eyebrow mb-2">Szybkie linki</div>
          <ul class="space-y-1">
            <li><a href="/blog">Blog</a></li>
            <li><a href="/#kontakt">Kontakt</a></li>
            <li><a href="#">Polityka prywatności</a></li>
          </ul>
        </div>
        <div>
          <div class="eyebrow mb-2">Dane</div>
          <p>tel. 123 456 789<br />biuro@twojeubezpieczenia.pl</p>
        </div>
      </div>
      <div class="py-4 text-center text-sm muted">
        © {new Date().getFullYear()} TwojeUbezpieczenia
      </div>
    </footer>

    {!import.meta.env.DEV && <link rel="stylesheet" href="/_pagefind/pagefind-ui.css" />}
  </body>
</html>
